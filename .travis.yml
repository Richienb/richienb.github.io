# Disable sudo to speed up build
sudo:                   false

# Set build language to Node JS
language:               node_js

# Set the version of Node JS to use
node_js:                node

# Set build branch
branches:               master

cache:
    # Ensure npm is cached
    directories:
        - node_modules # NPM packages

before_install:
    # Configure access token to enable pushing to the repository
    - git remote set-url origin https://Richienb:${github_token}@github.com/Richienb/richienb.github.io.git

    # Set commit username
    - git config --global user.name "ROS Bot"

    # Set commit email
    - git config --global user.email "richiebendall@gmail.com"

install:
    # Navigate to the source directory
    - cd src

    # Install the yarn package manager
    - npm install -g yarn

    # Install required packages
    - yarn install --non-interactive --production

script:
    # Build the website
    - npm run build

deploy:
    provider:           pages
    skip-cleanup:       true
    github-token:       $github_token
    keep-history:       true
    fqdn:               www.richie-bendall.ml
    committer-from-gh:  true
    on:
        branch:         master

after_deploy:
    # Clear CloudFlare cache
    - |
      curl --request DELETE "https://api.cloudflare.com/client/v4/zones/${cf_zone_id}/purge_cache" \
      --header "X-Auth-Email: richiebendall@gmail.com" \
      --header "X-Auth-Key: ${cf_api_key}" \
      --header "Content-Type: application/json" \
      --data '{"purge_everything":true}'

notifications:
    # Disable emails for build status notifications
    email:              false
